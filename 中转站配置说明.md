# OpenAI中转站配置说明

## 📋 重要说明

你提到你的中转站可以提供和OpenAI一样的模型服务（包括LLM、Embedding、STT、TTS），而且不使用LM Studio。

## ✅ 配置方法

### 当前配置（已正确）

你的 `docker-compose.yml` 配置是正确的：

```yaml
environment:
  - OPENAI_COMPATIBLE_BASE_URL=https://api.univibe.cc/openai/v1
  - OPENAI_COMPATIBLE_API_KEY=sk-i5oksIo7WZ3vSufagSK7bLKh9TNHyPWc
```

### 为什么这样配置？

虽然Provider Support Matrix表格显示"OpenAI Compatible*"只支持LLM，但这是因为：

1. **表格的说明**：表格中的"OpenAI Compatible"类别主要针对像LM Studio这样的工具，它们通常只支持LLM功能
2. **你的情况**：如果你的中转站**完全兼容OpenAI API**（实现了所有端点），那么设置 `OPENAI_COMPATIBLE_BASE_URL` 后，**所有功能都会使用你的中转站**：
   - ✅ LLM（语言模型）
   - ✅ Embedding（嵌入向量）
   - ✅ STT（语音转文字）
   - ✅ TTS（文字转语音）

### 工作原理

Open Notebook使用Esperanto库来处理AI提供商。当你设置 `OPENAI_COMPATIBLE_BASE_URL` 时：

1. Esperanto会使用这个URL作为所有OpenAI兼容API调用的基础URL
2. 如果你的中转站实现了所有OpenAI端点，所有功能都会正常工作
3. 在界面上会显示为"OpenAI Compatible"提供商，但功能是完整的

---

## 🔍 验证配置

### 1. 检查环境变量

```bash
docker exec open-notebook env | grep OPENAI_COMPATIBLE
```

应该看到：
```
OPENAI_COMPATIBLE_BASE_URL=https://api.univibe.cc/openai/v1
OPENAI_COMPATIBLE_API_KEY=sk-i5oksIo7WZ3vSufagSK7bLKh9TNHyPWc
```

### 2. 测试端点连接

```bash
# 测试LLM端点
curl https://api.univibe.cc/openai/v1/models \
  -H "Authorization: Bearer sk-i5oksIo7WZ3vSufagSK7bLKh9TNHyPWc"

# 测试Embedding端点
curl https://api.univibe.cc/openai/v1/embeddings \
  -H "Authorization: Bearer sk-i5oksIo7WZ3vSufagSK7bLKh9TNHyPWc" \
  -H "Content-Type: application/json" \
  -d '{"model":"text-embedding-3-small","input":"test"}'
```

### 3. 在Open Notebook中测试

1. 访问 http://localhost:8502
2. 进入 **Settings** → **Models**
3. 检查提供商列表，应该能看到"OpenAI Compatible"
4. 尝试配置和使用各个模型类型：
   - Language Model（LLM）
   - Embedding Model
   - Speech-to-Text（STT）
   - Text-to-Speech（TTS）

---

## 📝 关于表格说明

Provider Support Matrix表格中的"OpenAI Compatible*"只显示LLM支持，这是因为：

- **典型用例**：大多数OpenAI兼容端点（如LM Studio、vLLM）只提供LLM服务
- **你的情况**：如果你的中转站实现了完整的OpenAI API规范，**所有功能都会工作**

表格只是一个**通用指南**，实际支持的功能取决于你的端点实现。

---

## 🎯 如果遇到问题

### 问题1：某些功能不工作

**可能原因**：中转站的某些端点未实现或路径不同

**解决方案**：使用分别配置的方式

```yaml
environment:
  # 如果不同服务使用不同路径或端点
  - OPENAI_COMPATIBLE_BASE_URL_LLM=https://api.univibe.cc/openai/v1
  - OPENAI_COMPATIBLE_BASE_URL_EMBEDDING=https://api.univibe.cc/openai/v1
  - OPENAI_COMPATIBLE_BASE_URL_STT=https://api.univibe.cc/openai/v1
  - OPENAI_COMPATIBLE_BASE_URL_TTS=https://api.univibe.cc/openai/v1
  
  # 如果需要不同的API密钥
  - OPENAI_COMPATIBLE_API_KEY_LLM=sk-xxx
  - OPENAI_COMPATIBLE_API_KEY_EMBEDDING=sk-xxx
```

### 问题2：想显示为"OpenAI"而不是"OpenAI Compatible"

**说明**：Open Notebook通过环境变量来识别提供商：
- `OPENAI_API_KEY` → 识别为"OpenAI"（使用官方OpenAI端点）
- `OPENAI_COMPATIBLE_BASE_URL` → 识别为"OpenAI Compatible"（使用自定义端点）

**当前方案**：使用"OpenAI Compatible"是正确的，因为你在使用自定义端点。

---

## ✅ 总结

1. ✅ 你的配置是正确的
2. ✅ `OPENAI_COMPATIBLE_BASE_URL` 会覆盖所有OpenAI API调用
3. ✅ 如果中转站完全兼容，所有功能（LLM、Embedding、STT、TTS）都会工作
4. ✅ 表格中的"只支持LLM"是针对典型用例，不适用于完全兼容的中转站

**你的配置已经可以正常使用了！** 🎉

---

*最后更新：2024年*
